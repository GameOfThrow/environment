#!/usr/bin/env bash

echo "upgrade base gem system to latest version"
  sudo gem update --system
  sudo gem clean

echo "install xcode"
  sudo xcodebuild -license
  xcode-select --install
  read -p "Press any key to continue... " -n1 -s

echo "installing homebrew"
  ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/homebrew/go/install)"
  brew install wget
  wget https://raw.githubusercontent.com/damonmorgan/environment/master/Brewfile
  brew bundle

echo "add homebrew zsh to shells"
  sudo sh -c 'echo "/usr/local/bin/zsh" >> /etc/shells'

echo "post brew bundle"
  legit install
  initdb /usr/local/var/postgres -E utf8

echo "update pip"
  pip install --upgrade setuptools
  pip install --upgrade pip

echo "checking for SSH key, generating one if it doesn't exist ..."
  [[ -f ~/.ssh/id_rsa.pub ]] || ssh-keygen -t rsa -b 4096

echo "copying public key to clipboard. Paste it into your Github account ..."
  [[ -f ~/.ssh/id_rsa.pub ]] && cat ~/.ssh/id_rsa.pub | pbcopy
  open https://github.com/account/ssh
  read -p "Press any key once you have pasted into your Github account..." -n1 -s

echo "fetch dotfiles"
  git clone git@github.com:damonmorgan/dotfiles.git ~/.dotfiles

echo "install dotfiles"
  cd ~/.dotfiles
  git submodule update --init
  rake install

echo "install standalone Heroku CLI client. You'll need administrative rights on your machine ..."
  wget -qO- https://toolbelt.heroku.com/install.sh | sh

echo "install heroku plugins"
  /usr/local/heroku/bin/heroku plugins:install git://github.com/ddollar/heroku-config.git
  /usr/local/heroku/bin/heroku plugins:install git://github.com/ddollar/heroku-accounts.git
  /usr/local/heroku/bin/heroku plugins:install git://github.com/heroku/heroku-pg-extras.git
  /usr/local/heroku/bin/heroku plugins:install git://github.com/ddollar/heroku-redis-cli.git

echo "init Vundle and install"
  vim -c "execute \"BundleInstall\" | q | q"

echo "build Command-T plugin"
  cd ~/.dotfiles/vim/bundle/command-t
  rake make

echo "create development directory"
  cd ~/
  mkdir development

echo "install snippets"
  cd ~/development
  git clone git://github.com/scrooloose/snipmate-snippets.git
  cd ~/development/snipmate-snippets
  read -p "Press any key once you have edited Rakefile and changed snipmate to snipmate.vim" -n1 -s
  rake deploy_local

echo "get better colour scheme for terminal"
  cd ~/development
  git clone git://github.com/altercation/solarized.git

echo "install sshuttle"
  cd ~/
  git clone git://github.com/apenwarr/sshuttle.git

echo "install AWS cli"
  pip install awscli

echo "latest ruby"
  export RBENV_ROOT=$(brew --prefix rbenv)
  ruby_version="$(curl -sSL http://ruby.thoughtbot.com/latest)"
  eval "$(rbenv init -)"
  rbenv install "$ruby_version"
  rbenv local "$ruby_version"
  rbenv rehash
  gem update --system
  gem clean
  gem install bundler
